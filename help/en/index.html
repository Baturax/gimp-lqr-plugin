<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
  <title>Help Page for gimp-lqr-plugin</title>
</head>

<body text="#000000" bgcolor="#FFFFFF" link="#0000FF"
      vlink="#FF0000" alink="#000088">

  <table width="100%" cellspacing="1" cellpadding="1">
    <tr>
      <td width="100%" align="center">
	<img src="../images/wilber.png">
      </td>
    </tr>
    <tr bgcolor="black">
      <td width="100%" align="center">
        <font size="+2" color="white">Liquid Rescale help page</font>
      </td>
    </tr>  
    <tr>
      <td width="100%" align="left">
	<p>
		The Liquid Rescale plugin is an implementation of the content-aware resizing by
		seam carving algorithm by Shai Avidan and Ariel Shamir.
	</p>
        <p>
		It aims at resizing pictures non uniformly while preserving the features of the picture,
		i.e. avoiding distortion of the important parts of the picture.
		It can also be used to remove portions of the picture in a consistent way.
	</p>
        <p>
		It works both ways, but enlarging gives better results if done in successive steps.
		It can use extra layers as masks to select which features of the image should be
		preserved and which should be discarded.
	</p>
	<p>
		The plugin works on the active layer or floating selection. It can also operate on multiple layers
		through the <i>"Filter all layers"</i> plugin and using the Gimp Ainmation Package facilities for
		video editing.
	<p>
	</p>
 		The plugin only works on whole layers, if a selection is present it is saved to a channel and removed.
		If the layer has a transparency mask, an option is given to select the behaviour (apply/discard).
	</p>
	
	<h2>User interface description</h2>
	<p>
		<img title="Dialog example" alt="Dialog example" src="../images/dialog1.png">
	</p>
	
	<h3>Select new width and height</h3>
	<p>
		<div>
			In this section it is possible to choose the size and the mode of operation.
			It is advisable to rescale always in one direction at a time. If both 
			the width and the height are changed, rescaling is performed by default on the
			width first, then on the height. This can be changed in the <i>"Advanced"</i> tab.
		</div>
		<div>
			The two small buttons on the right can be used to reset the size parameters
			to the image size (top) or set them to the last used values (bottom).
		</div>
		<div>
			The default mode is just liquid rescaling to the desired size.
			The other options are to apply liquid rescaling or the standard scaling
			back to the original size once the first liquid rescaling is done.
			This can be useful for example for object removal and content enhancement.
		</div>
	</p>
	<p>
		Note that the final size can be set automatically when removing objects, see below
	</p>


	<h3>Feature masks</h3>
	<h4>Quick guide</h4>
	<p>
		The easiest way to manually select the features of the image that you want to protect
		or discard is the following:
		<ul>
			<li>
				Select the layer you want to resize (not a floating selection) and invoke the plugin
			</li><li>
				Press the <i>"New"</i> button in the <b>"Feature preservation mask"</b> section
				(this will create a transparent layer, with 50% opacity, and pick an appropriate
				colour).
			</li><li>
				Put the plugin dialog aside and paint on the areas of the image you want to preserve
			</li><li>
				Go back to the plugin dialog and press the refresh button to see the mask you painted
			</li><li>
				Repeat everything for the features to discard
			</li>
		</ul>
	</p>
		If you want to remove portions of the image, you can choose the scaling direction
		(horizontal/vertical) and finally press the <i>"Auto size"</i> button to determine
		the final size automatically (this is only reliable when dealing with very simple
		masks).
	</p>
	<p>
		<b>Note #1:</b> object removal is only possible when shrinking. By default,
		feature discard masks are ignored when enlarging, because in that case the masked
		areas would be inflated rather then removed. If you actually want to get this effect,
		you need to unset the corresponding option in the <i>"Advanced"</i> tab.
	</p>
	<p>
		<b>Note #2:</b> preservation of features is not possible if enlarging too much,
		because the inflation process is the exact reverse of the shrinking process,
		so the maximum amount of pixels you can add to a layer corresponds to the 
		amount of pixels which are not protected. For example, if you have a 1000 pixel
		wide image and you have marked a 800 pixel wide area for protection, the final
		width should be less than 1200 pixels. If you want to enlarge more, do it in
		steps.
	</p>
		

	<h4>Full description</h4>
	<p>
		<div>
			In the <b>"Feature preservation mask"</b> section
			it is possible to specify if there are regions of the image which
			should be preserved from modification, by checking the <i>"Activate feature preservation"</i>
			box, and by choosing a layer among the ones which belong to the current image (excluding the active one)
			in the <i>"Available layers"</i> menu.
			The <i>"New"</i> button creates a transparent layer with 50% opacity and an appropriate name,
			and sets it as the selected layer mask (note that this fails if the plugin is invoked on a
			floating selection, because Gimp does not allow to work on other layers in such case).
			It also sets the foreground colour to green; the previous colour is restored when the
			dialog is closed.
		</div>
		<div>
			The intensity of the effect of the mask on each pixel is obtained as
			the average on the pixel's colour channels, multiplied by the alpha channel. Thus, for an RGB layer
			with an alpha channel, the maximum value is achieved on white pixels, while black ones
			and transparent ones are ignored.
			In general, it is advisable to work in monochrome, and modulate the intensity by the transparency
			in case fine tuning is needed, e.g. by using the quickmask.
		</div>
		<div>
			The size and position of the selected layer can be arbitrary, the plugin will only use
			those portions which overlap with the active layer.
			The <i>"Strength"</i> scale can be used as a global parameter to modulate the feature preservation.
			Note that the strength value automatically accounts for the size of the image,
			but not for that of the masked areas: thinner selection areas (in the sense of the resizing) need
			higher strength values, and vice-versa.
		</div>
	</p>
	<p>
		<div>
			The <b>Feature discard selection</b> section is nearly identical to the previous one,
			but the effect is reversed, and the default colour for the <i>"New"</i> button is red instead of green.
		</div>
		<div>
			Furthermore, there's an additional button, <i>"Auto size"</i>, which sets the final size of
			the layer automatically. The nearby menu can be used to determine if the scaling will be
			performed in the horizontal or in the vertical sense (the other direction will be
			set to its initial value).
		</div>
		<div>
			Note that this option is only suitable for naive object removals, since the final size is
			determined by simply finding out the maximum number of pixels in a line for which the mask
			value is above a given threshold, and it may fail if the masks are non-trivial.
			The threshold is set to the 50% of a full RGB colour (e.g. red in the default setting).
		</div>
	</p>

	<h3>Output</h3>
	<p>
		<img title="Output" alt="Output" src="../images/dialog2.png">
	</p>
	<p>
		This tab has a number of options related to the output of the plugin.
	</p>
	<p>
		<dl>
		<dt><b>Output on a new layer</b></dt>
		<dd>
			Specifies if the resized image should be written on a new layer.
			By default, it is off.
		</dd>
		<dt><b>Resize image canvas</b></dt>
		<dd>
			Specifies whether the image canvas should be resized to meet the new size of the active
			layer. By default, it is on.
		</dd>
		<dt><b>Resize auxiliary layers</b></dt>
		<dd>
			Specifies whether the layers used to manually select the features of the image
			or to specify a rigidity mask will be resized along with the active layer.
			If this option is checked, those layers will be first cropped to the active layer's size,
			then they will undergo the same seam carving and inserting process as the active layer.
			By default, it is on, but it is only active when some layers are selected in
			the <i>"Feature masks"</i> tab or if a rigidity mask is being used (see below).
		</dd>
		<dt><b>Output the seams on a new layer</b></dt>
		<dd>
			Specifies whether to create a new layer with the seams map.
			The seams colour range can be manually choosen with the two buttons on the right.
			The seams are computed on the original layer as far as they are needed for the new size
			(e.g. there will be 100 seams if reducing or enlarging by 100 pixels), the remaining
			areas are transparent. In order to read the result, use this option together with
			<i>"Output on a new layer"</i>, and overlay the seam map to the original layer.
			If you rescale in two directions at once, you will obtain two maps, but the second
			one will be computed over an invisible intermediate image, so this is not very useful.
			The same applies in the case you choose to rescale back to the original size with LqR.
		</dd>
		</dl>
	</p>
	<h3>Advanced</h3>
	<p>
		<img title="Advanced" alt="Advanced" src="../images/dialog3.png">
	</p>
	<p>
		This tab has some options which can be used to tweak the plugin behavior.
	</p>
	<p>
		<dl>
		<dt><b>Seams control</b></dt>
		<dd>
			<dl>
			<dt>Max transversal step</dt>
			<dd>
				<div>
				This option lets you choose the maximum transversal step that the pixels in the seams can
				take. In the standard algorithm, corresponing to the default value step = 1, each pixel
				in a seam can be shifted by at most one pixel with respect to its neighbors.
				This implies that the seams can form an angle of at most 45 degrees with respect
				to their base line.
				</div>
				<div>
				Increasing the step value lets you overcome this limit, but may lead to the
				introduction of artifacts. In order to balance the situation, you can use
				the rigidity setting.
				</div>
			</dd>
			<dt>Overall rigidity</dt>
			<dd>
				Use this value to give a negative bias to the seams which are not straight. May be useful
				to prevent distortions in some situations, or to avoid artifacts from pixel skipping
				(it is better to use low values in such case). This setting applies to the whole
				selected layer if no rigidity mask is used.
				The bias is proportional to the difference in the transversal coordinate between each
				two successive points, elevated to the power of 1.5, and summed up for the whole seam.
			</dd>
			<dt>Use a rigidity mask</dt>
			<dd>
				<div>
				It is possible to specify different rigidity values for different areas of the image,
				using an auxiliary layer, by following the same procedure used to specify the feature masks
				(the default colour for newly created rigidity masks is blue).
				If a rigidity mask is specified, its value at each pixel (computed in the same way as
				for the feature masks) will be used as a rigidity coefficient, to be multiplied with the
				overall one.
				</div>
				<div>
				Note #1: transparent (or black) areas in the rigidity mask always correspond to
				0 rigidity, no matter what the overall value is.
				</div>
				<div>
				Note #2: rigid areas have a slight repulsive effect on seams, similar to that
				of a preservation mask. In order to compensate for this, you may use a discard mask.
				</div>
			</dd>
			</dl>
		</dd>
		<dt><b>Gradient function</b></dt>
		<dd>
			It is possible to choose which function
			is to be used to calculate the energy map of the image. For each pixel in the image,
			the x,y components of the gradient are computed from the pixel's four nearest neighbors.
			The exact form of the energy map depends on the choice of the gradient function, and
			this in turn determines which elements of the image are more important, and should
			thus be preserved, and which are not, and can be removed (if shrinking) or inflated
			(if enlarging). Using the <i>Null</i> function in conjunction with the feature preservation
			mask can be used to override completely the automatic feature detection, thus
			allowing the user to generate his own energy map (e.g. by another plugin).
		</dd>
		<dt><b>Rescale order</b></dt>
		<dd>
			When rescaling in both directions at the same time, it can be choosen whether to resize
			first in the horizontal and then in the vertical direction, or vice versa.
		</dd>
		<dt><b>Ignore dicard mask when enlarging</b></dt>
		<dd>
			The effect of the discard mask is reversed when the plugin is used for enlarging an image;
			as this is normally undesirable, they are ignored by default when the
			first scaling direction is to be enlarged (in such cases, a small warning icon will
			appear in the <i>"Feature dicard mask"</i> section).
			Unset this option if you want to override this behaviour.
		</dl>
      <h3>Using the plugin for video and animation editing</h3>
      <h4>Using the plugin with GAP</h4>
      <p>
	      	The plugin can take advantage of the Gimp Animation Package (GAP) for video editing,
		making it possible to apply liquid rescaling to all the frames of a video (please refer
		to the GAP documentation for instructions about video editing in Gimp).
      <p>
      </p>
		Note however that the GAP facilities only allow to select the working layer, but the
		liquid rescale plugin needs auxiliary layers as well to work at its full potential.
		In order to work around this problem, auxiliary layers are set according to their names:
		therefore, if you want to use a preservation mask in each frame, for example, you should
		take care that all the layers which you intend to use as such have the same name in all
		of the frames. The same applies to discard masks and rigidity masks.
      </p>
      <p>
	        <div>
		In order to use liquid rescale on all frames, you need select <i>"Frame Modify"</i> in
		the <i>"Video"</i> menu; this will open a dialog: in the <i>"Function"</i> section select <i>"Apply filter
		on layer(s)"</i>, then set appropriate rules for layer selection and frame range and
		click OK. Another dialog will appear, asking you to choose a filter: select
		<i>plug-in-lqr</i>, then choose either <i>"Apply constant"</i> or <i>"Apply varying"</i>.
		</div><div>
		In the latter case, you will be presented the liquidrescale plugin dialog twice, once
		for the first frame and once for the last one: these will set the extreme values for 
		all the graded parameters (such as sizes, strengths, rigidity etc.), and
		intermediate values will be used in the intermediate frames. However, all the
		options (such as the resize order, the auxiliary layer names etc.)
		will be taken from the <u>last</u> dialog for all the intermediate frames.
		</div>
      </p>
      <h4>Applying the plugin to all layers (e.g. for animations)</h4>
      <p>
      		It is also possible to apply the plugin to all the layers in a given image (for example
		when editing an animation), using the option <i>"Filter all layers..."</i> from the
		<i>"Filters"</i> menu and choosing <i>"plug-in-lqr"</i> in the dialog which appears.
		Operations follow the rules explained in the GAP section; however, you will run into
		problems if using auxiliary layers as masks, since the plugin will be applied
		to those as well.
      </p>
      </td>
    </tr>
  </table>

</body>
</html>
